<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>文章列表 - M3U8播放器在线</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="文章列表，展示 docs 目录下的文章。支持从 manifest.json 加载元数据。">
    <link rel="stylesheet" href="./css/styles.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3530207113372131"
    crossorigin="anonymous"></script>
</head>

<body>
    <div class="topbar">
        <a href="index.html">首页</a>
        <a href="docs.html" class="active">文章页</a>
    </div>

    <div class="shell">
        <div class="header">
            <div>
                <h2 style="margin:0">文章列表</h2>
            </div>
        </div>

        <div id="list" class="list"></div>
        <div id="empty" class="empty" style="display:none"></div>
    </div>

    <div class="footer" id="footerLinks"></div>

    <script src="./js/common.js"></script>
    <script>
        const listEl = document.getElementById('list');
        const emptyEl = document.getElementById('empty');

        function renderArticles(articles) {
            if (!articles || articles.length === 0) {
                emptyEl.style.display = 'block';
                emptyEl.textContent = '未找到文章。请在项目的 docs/ 目录中添加 markdown 或 html 文件，并可选创建 docs/manifest.json。';
                return;
            }
            const frag = document.createDocumentFragment();
            articles.forEach(function (item) {
                const card = document.createElement('article');
                card.className = 'card article-card';

                const h3 = document.createElement('h3');
                h3.className = 'title';
                const link = document.createElement('a');
                link.href = item.path || '#';
                link.textContent = item.title || '未命名文章';
                link.style.textDecoration = 'none';
                link.style.color = 'inherit';
                h3.appendChild(link);

                const meta = document.createElement('div');
                meta.className = 'meta';
                if (item.date) {
                    const dateSpan = document.createElement('span');
                    dateSpan.textContent = item.date;
                    meta.appendChild(dateSpan);
                }
                if (item.author) {
                    const au = document.createElement('span');
                    au.textContent = '作者：' + item.author;
                    meta.appendChild(au);
                }

                const desc = document.createElement('p');
                desc.className = 'desc';
                desc.textContent = item.summary || item.description || '';

                const tagWrap = document.createElement('div');
                tagWrap.className = 'tags';
                if (Array.isArray(item.tags)) {
                    item.tags.forEach(function (t) {
                        const tag = document.createElement('span');
                        tag.className = 'tag';
                        tag.textContent = t;
                        tagWrap.appendChild(tag);
                    });
                }

                const actions = document.createElement('div');
                actions.className = 'actions';
                const readBtn = document.createElement('a');
                readBtn.className = 'btn';
                readBtn.href = item.path || '#';
                readBtn.textContent = '阅读';
                readBtn.target = '_blank';
                readBtn.rel = 'noopener';

                actions.appendChild(readBtn);

                card.appendChild(h3);
                card.appendChild(meta);
                if (desc.textContent) card.appendChild(desc);
                if (tagWrap.childNodes.length) card.appendChild(tagWrap);
                card.appendChild(actions);

                frag.appendChild(card);
            });
            listEl.appendChild(frag);
        }

        function normalizeArticles(data) {
            if (!data) return [];
            if (Array.isArray(data)) return data;
            if (Array.isArray(data.articles)) return data.articles;
            return [];
        }

        async function loadManifest() {
            try {
                const res = await fetch('manifest.json', { cache: 'no-cache' });
                if (!res.ok) throw new Error('manifest not found');
                const json = await res.json();
                const articles = normalizeArticles(json);
                if (!articles.length) throw new Error('empty manifest');
                renderArticles(articles);
            } catch (e) {
                emptyEl.style.display = 'block';
                emptyEl.innerHTML = '未检测到 <code>docs/manifest.json</code>，请创建示例：<pre style="margin-top:8px;white-space:pre-wrap;background:#fff;padding:10px;border-radius:8px;border:1px solid var(--border)">\
{\n  "articles": [\n    {\n      "title": "示例文章",\n      "path": "docs/example.html",\n      "date": "2025-01-01",\n      "author": "作者名",\n      "summary": "这里是摘要……",\n      "tags": ["HLS", "M3U8"]\n    }\n  ]\n}\n</pre>';
            }
        }

        function renderFooter(links) {
        }

        loadManifest();
    </script>
</body>

</html>